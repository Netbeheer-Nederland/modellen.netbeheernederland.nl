<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Redirecting...</title>
    <script>
        // CONFIGURATION
        var newHostname = "netbeheer-nederland.github.io";
        var paramName = "cache_bypass";
        var loopTimeLimit = 1000; // Reset attempts if more than 1000ms passed

        if (window.location.hostname !== newHostname) {
            
            var now = Date.now();
            var storageKeyCount = 'redirect_count_' + newHostname;
            var storageKeyTime = 'redirect_time_' + newHostname;
            
            // Retrieve stored data
            var attempts = parseInt(sessionStorage.getItem(storageKeyCount) || "0");
            var lastAttemptTime = parseInt(sessionStorage.getItem(storageKeyTime) || "0");
            
            // TIMEOUT CHECK:
            // If the last attempt was more than 1 second ago, we assume it's a fresh visit
            // (or user clicked 'back' after reading the page). Reset counter.
            if ((now - lastAttemptTime) > loopTimeLimit) {
                attempts = 0;
            }

            var url = new URL(window.location.href);
            url.hostname = newHostname;
            url.protocol = "https:";

            // --- PHASE 1: First Attempt (Clean URL) ---
            if (attempts === 0) {
                // Store current time and increment counter to 1
                sessionStorage.setItem(storageKeyTime, now);
                sessionStorage.setItem(storageKeyCount, "1");
                
                window.location.replace(url.href);
            } 
            
            // --- PHASE 2: Second Attempt (With Cache Buster) ---
            // We only get here if the user bounced back within 1000ms
            else if (attempts === 1) {
                // Store current time and increment counter to 2
                sessionStorage.setItem(storageKeyTime, now);
                sessionStorage.setItem(storageKeyCount, "2");
                
                // Add bypass parameter
                url.searchParams.set(paramName, now);
                
                console.warn("Rapid redirect loop detected (<" + loopTimeLimit + "ms). Retrying with cache bypass parameter...");
                window.location.replace(url.href);
            }
            
            // --- PHASE 3: Surrender (Show Error Message) ---
            // We get here if the user bounced back AGAIN within 1000ms after phase 2
            else {
                console.error("Persistent redirect loop detected. Automatic redirection stopped.");
                
                // Generate fresh timestamp for the manual link
                url.searchParams.set(paramName, now);

                window.onload = function() {
                    document.body.innerHTML = 
                        '<div style="font-family: sans-serif; max-width: 600px; margin: 2rem auto; line-height: 1.6;">' +
                        '<h1>Automatic Redirection Interrupted</h1>' +
                        '<p>Your browser is retaining outdated cache information, which is causing a redirection loop.</p>' +
                        '<p><strong><a href="' + url.href + '">Click here to force a reload to the new website &rarr;</a></strong></p>' +
                        '<hr style="margin: 20px 0; border: 0; border-top: 1px solid #ccc;">' +
                        '<p style="font-size: 0.9em; color: #555;">To resolve this issue permanently for the original link:</p>' +
                        '<ul style="font-size: 0.9em; color: #555;">' +
                            '<li><strong>Chrome Users:</strong> Copy and paste <code>chrome://settings/clearBrowserData</code> into your address bar and clear "Cached images and files".</li>' +
                            '<li><strong>Alternative:</strong> Open the site in Incognito Mode (Private Browsing).</li>' +
                        '</ul>' +
                        '</div>';
                };
            }
        }
    </script>
</head>
<body>
    <p>Redirecting...</p>
</body>
</html>